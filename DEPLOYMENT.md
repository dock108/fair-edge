# Fair-Edge Deployment Guide

## üöÄ Quick Start

### Local Development (5-minute refresh for stress testing)
```bash
./deploy.sh local
```

### Production Deployment (30-minute business hours refresh)
```bash
export HETZNER_PASSWORD='XVtThmPLMaPTXTekANdA'
./deploy.sh production
```

## üìÅ Environment Files

- `.env.local` - Local development configuration (5-min refresh)
- `.env.production` - Production configuration (30-min business hours)
- `.env` - Active configuration (auto-generated by deploy script)

## üîß Manual Environment Switching

Switch environments without deploying:
```bash
# Switch to local
./switch-env.sh local

# Switch to production
./switch-env.sh production
```

## üèóÔ∏è Architecture

### Local Development
- **Frontend**: http://localhost:5173 (Vite dev server)
- **API**: http://localhost:8000
- **Refresh**: Every 5 minutes (stress test mode)
- **Debug**: Enabled with dev tools

### Production (Hetzner)
- **Domain**: https://dock108.ai
- **Frontend**: Static files served by Caddy
- **API**: Reverse proxied through Caddy
- **Refresh**: 
  - Business hours (7 AM - 10 PM EST): Every 30 minutes
  - Off hours: Hourly with activity checking
- **SSL**: Auto-managed by Caddy

## üõ†Ô∏è Configuration Details

### Docker Compose Files
- `docker-compose.yml` - Base configuration
- `docker-compose.override.yml` - Local development overrides
- `docker-compose.production.yml` - Production overrides

### Key Differences

| Feature | Local | Production |
|---------|-------|------------|
| Environment | development | production |
| API URL | http://localhost:8000 | https://dock108.ai |
| Refresh Interval | 5 minutes | 30 minutes (business hours) |
| Debug Mode | true | false |
| Analytics | false | true |
| Caddy Proxy | disabled | enabled |
| SSL | none | Let's Encrypt |

## üìä Monitoring

### Local
```bash
# Watch logs
docker compose logs -f celery_worker celery_beat

# Monitor stress test
./monitor_stress_test.sh
```

### Production
```bash
# SSH to server
ssh root@178.156.185.113

# Check logs
docker compose logs -f api celery_worker

# Check status
docker compose ps
```

## üîÑ Updating

### Local
```bash
# Just restart services
docker compose restart
```

### Production
```bash
# Full redeploy
./deploy.sh production

# Or manual update
scp file.py root@178.156.185.113:/opt/fair-edge/
ssh root@178.156.185.113 "cd /opt/fair-edge && docker compose restart api"
```

## üêõ Troubleshooting

### Environment Issues
```bash
# Check active environment
grep ENVIRONMENT .env

# Verify refresh interval
grep REFRESH_INTERVAL .env
```

### Service Issues
```bash
# Local
docker compose ps
docker compose logs api

# Production
ssh root@178.156.185.113 "cd /opt/fair-edge && docker compose ps"
```

## üîê Security Notes

1. Never commit `.env` files with real credentials
2. Use `.env.local` and `.env.production` templates
3. Store production secrets securely
4. Keep `HETZNER_PASSWORD` in environment variable, not files