{% extends "base.html" %}

{% block title %}Pricing - Sports Betting +EV Analyzer{% endblock %}

{% block head %}
<meta name="description" content="Choose your plan for Sports Betting +EV Analyzer. Free tier with 10 opportunities or Premium with unlimited access and advanced analytics.">
<meta name="keywords" content="sports betting, pricing, premium, subscription, EV calculator">
{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Header -->
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold mb-3">Choose Your Plan</h1>
        <p class="lead text-muted">Get the betting insights you need to make informed decisions</p>
    </div>

    <!-- Pricing Cards -->
    <div class="row justify-content-center">
        <!-- Free Tier -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 border-secondary">
                <div class="card-header bg-light text-center">
                    <h3 class="card-title mb-0">Free Tier</h3>
                    <div class="mt-3">
                        <span class="display-4 fw-bold">$0</span>
                        <span class="text-muted">/month</span>
                    </div>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>10 opportunities</strong> per session
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            Basic EV analysis
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            30-minute data refresh
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            Educational resources
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-times text-muted me-2"></i>
                            <span class="text-muted">No advanced analytics</span>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-times text-muted me-2"></i>
                            <span class="text-muted">No export capabilities</span>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-times text-muted me-2"></i>
                            <span class="text-muted">No custom alerts</span>
                        </li>
                    </ul>
                </div>
                <div class="card-footer text-center">
                    <a href="/login" class="btn btn-outline-primary btn-lg w-100">
                        Get Started Free
                    </a>
                </div>
            </div>
        </div>

        <!-- Premium Tier -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 border-warning shadow position-relative">
                <div class="badge bg-warning text-dark position-absolute top-0 start-50 translate-middle px-3 py-2 rounded-pill">
                    Most Popular
                </div>
                <div class="card-header bg-warning text-dark text-center">
                    <h3 class="card-title mb-0">Premium</h3>
                    <div class="mt-3">
                        <span class="display-4 fw-bold">$29</span>
                        <span class="text-muted">/month</span>
                    </div>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li class="mb-3">
                            <i class="fas fa-star text-warning me-2"></i>
                            <strong>Unlimited opportunities</strong>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-star text-warning me-2"></i>
                            Advanced analytics & confidence scoring
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-star text-warning me-2"></i>
                            5-minute data refresh
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-star text-warning me-2"></i>
                            Export to CSV/Excel
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-star text-warning me-2"></i>
                            Custom filters & alerts
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-star text-warning me-2"></i>
                            Historical performance tracking
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-star text-warning me-2"></i>
                            Priority customer support
                        </li>
                    </ul>
                </div>
                <div class="card-footer text-center">
                    <button id="buy-premium" class="btn btn-warning btn-lg w-100 text-dark fw-bold" onclick="upgradeToPremium()">
                        <span class="button-text">Upgrade to Premium</span>
                        <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    </button>
                    <small class="text-muted d-block mt-2">Cancel anytime</small>
                </div>
            </div>
        </div>

        <!-- Enterprise Tier (Future) -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 border-primary">
                <div class="card-header bg-primary text-white text-center">
                    <h3 class="card-title mb-0">Enterprise</h3>
                    <div class="mt-3">
                        <span class="display-6 fw-bold">Custom</span>
                    </div>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li class="mb-3">
                            <i class="fas fa-check-circle text-primary me-2"></i>
                            Everything in Premium
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check-circle text-primary me-2"></i>
                            API access
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check-circle text-primary me-2"></i>
                            Real-time notifications
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check-circle text-primary me-2"></i>
                            Custom integrations
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check-circle text-primary me-2"></i>
                            Dedicated account manager
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check-circle text-primary me-2"></i>
                            White-label options
                        </li>
                    </ul>
                </div>
                <div class="card-footer text-center">
                    <a href="mailto:sales@betintel.com" class="btn btn-primary btn-lg w-100">
                        Contact Sales
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Feature Comparison -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="text-center mb-4">Feature Comparison</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>Feature</th>
                            <th class="text-center">Free</th>
                            <th class="text-center">Premium</th>
                            <th class="text-center">Enterprise</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Betting Opportunities</td>
                            <td class="text-center">10 per session</td>
                            <td class="text-center"><i class="fas fa-infinity text-warning"></i> Unlimited</td>
                            <td class="text-center"><i class="fas fa-infinity text-primary"></i> Unlimited</td>
                        </tr>
                        <tr>
                            <td>Data Refresh Rate</td>
                            <td class="text-center">30 minutes</td>
                            <td class="text-center">5 minutes</td>
                            <td class="text-center">Real-time</td>
                        </tr>
                        <tr>
                            <td>Advanced Analytics</td>
                            <td class="text-center"><i class="fas fa-times text-muted"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Export Capabilities</td>
                            <td class="text-center"><i class="fas fa-times text-muted"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Custom Alerts</td>
                            <td class="text-center"><i class="fas fa-times text-muted"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>API Access</td>
                            <td class="text-center"><i class="fas fa-times text-muted"></i></td>
                            <td class="text-center"><i class="fas fa-times text-muted"></i></td>
                            <td class="text-center"><i class="fas fa-check text-success"></i></td>
                        </tr>
                        <tr>
                            <td>Support Level</td>
                            <td class="text-center">Community</td>
                            <td class="text-center">Email Priority</td>
                            <td class="text-center">Dedicated Manager</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- FAQ Section -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="text-center mb-4">Frequently Asked Questions</h3>
            <div class="accordion" id="pricingFAQ">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                            Can I cancel my subscription anytime?
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#pricingFAQ">
                        <div class="accordion-body">
                            Yes, you can cancel your subscription at any time. Your access will continue until the end of your current billing period.
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                            Is there a free trial for Premium?
                        </button>
                    </h2>
                    <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#pricingFAQ">
                        <div class="accordion-body">
                            We offer a 7-day free trial for Premium features. No credit card required to start your trial.
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                            How accurate are the EV calculations?
                        </button>
                    </h2>
                    <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#pricingFAQ">
                        <div class="accordion-body">
                            Our models are based on comprehensive market analysis and statistical modeling. While we strive for accuracy, all betting involves risk and no system guarantees profits.
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingFour">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                            Is this for educational purposes only?
                        </button>
                    </h2>
                    <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#pricingFAQ">
                        <div class="accordion-body">
                            Yes, our platform is designed for educational and research purposes to help users understand betting markets and EV analysis. Always gamble responsibly.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/static/js/auth.js"></script>
<script>
async function upgradeToPremium() {
    const button = document.getElementById('buy-premium');
    const buttonText = button.querySelector('.button-text');
    const spinner = button.querySelector('.spinner-border');
    
    try {
        // Show loading state
        button.disabled = true;
        buttonText.textContent = 'Processing...';
        spinner.classList.remove('d-none');
        
        // Check if user is authenticated
        const user = await getCurrentUser();
        if (!user) {
            // Redirect to login if not authenticated
            window.location.href = '/login?redirect=' + encodeURIComponent('/pricing');
            return;
        }
        
        // Check if user is already a subscriber
        if (user.role === 'subscriber' && user.subscription_status === 'active') {
            alert('You are already a Premium subscriber!');
            return;
        }
        
        // Create Stripe checkout session
        const response = await authenticatedFetch('/api/billing/create-checkout-session', {
            method: 'POST',
            credentials: 'include'
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || 'Failed to create checkout session');
        }
        
        const data = await response.json();
        
        // Redirect to Stripe Checkout
        window.location.href = data.checkout_url;
        
    } catch (error) {
        console.error('Error upgrading to premium:', error);
        alert('Error: ' + error.message);
    } finally {
        // Reset button state
        button.disabled = false;
        buttonText.textContent = 'Upgrade to Premium';
        spinner.classList.add('d-none');
    }
}

// Helper function to get current user
async function getCurrentUser() {
    try {
        const response = await authenticatedFetch('/me', {
            credentials: 'include'
        });
        
        if (response.ok) {
            return await response.json();
        }
        return null;
    } catch (error) {
        console.error('Error getting current user:', error);
        return null;
    }
}
</script>
{% endblock %} 